<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>00878 å­˜è‚¡ç´€éŒ„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #4ca1af 100%);
            min-height: 100vh;
            padding: 15px;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }
        .header .stock-code {
            font-size: 36px;
            font-weight: bold;
        }
        .header .stock-name {
            font-size: 18px;
            opacity: 0.9;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* å ±é…¬ç‡å¡ç‰‡ */
        .profit-card {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            text-align: center;
            padding: 25px;
        }
        .profit-card.negative {
            background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%);
        }
        .profit-label {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        .profit-percent {
            font-size: 42px;
            font-weight: bold;
        }
        .profit-amount {
            font-size: 24px;
            margin-top: 5px;
        }

        /* æ•¸æ“šæ ¼å­ */
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .data-grid.three-col {
            grid-template-columns: 1fr 1fr 1fr;
        }
        .data-item {
            background: #f5f7fa;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        .data-item.highlight {
            background: #e8f4fd;
            border: 2px solid #3498db;
        }
        .data-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 6px;
        }
        .data-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .data-value.price {
            color: #e74c3c;
        }
        .data-value.small {
            font-size: 20px;
        }

        /* è²·é€²ç´€éŒ„ */
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .record-table {
            width: 100%;
            border-collapse: collapse;
        }
        .record-table th {
            background: #f5f7fa;
            padding: 10px 5px;
            font-size: 13px;
            color: #7f8c8d;
            font-weight: 500;
        }
        .record-table td {
            padding: 12px 5px;
            text-align: center;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            color: #2c3e50;
        }
        .record-table tr:last-child td {
            border-bottom: none;
        }
        .record-table .date {
            font-weight: 500;
        }
        .record-table .dividend {
            color: #27ae60;
            font-weight: bold;
        }

        /* é å°¾ */
        .footer {
            text-align: center;
            color: rgba(255,255,255,0.7);
            font-size: 13px;
            margin-top: 15px;
        }

        /* æ›´æ–°æŒ‰éˆ• */
        .refresh-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .refresh-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .status {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="header">
            <div class="stock-code">00878</div>
            <div class="stock-name">åœ‹æ³°æ°¸çºŒé«˜è‚¡æ¯</div>
        </div>

        <!-- æ›´æ–°è‚¡åƒ¹æŒ‰éˆ• -->
        <button class="refresh-btn" onclick="fetchPrice()">
            ğŸ”„ æ›´æ–°æœ€æ–°è‚¡åƒ¹
            <div class="status" id="status">é»æ“Šè‡ªå‹•æŠ“å–æœ€æ–°åƒ¹æ ¼</div>
        </button>


        <!-- å ±é…¬ç‡ -->
        <div class="card profit-card" id="profitCard">
            <div class="profit-label">å ±é…¬ç‡ï¼ˆå«æ¯ï¼‰</div>
            <div class="profit-percent" id="profitPercent">+0.54%</div>
            <div class="profit-amount" id="profitAmount">+230 å…ƒ</div>
        </div>

        <!-- åƒ¹æ ¼è³‡è¨Š -->
        <div class="card">
            <div class="data-grid three-col">
                <div class="data-item">
                    <div class="data-label">å¹³å‡æˆæœ¬</div>
                    <div class="data-value small" id="avgCost">21.14</div>
                </div>
                <div class="data-item highlight">
                    <div class="data-label">ç›®å‰å¸‚åƒ¹</div>
                    <div class="data-value small price" id="currentPrice">21.25</div>
                </div>
                <div class="data-item">
                    <div class="data-label">ç¸½è‚¡åˆ©</div>
                    <div class="data-value small" id="totalDividend">0</div>
                </div>
            </div>
        </div>

        <!-- æŒè‚¡è³‡è¨Š -->
        <div class="card">
            <div class="data-grid">
                <div class="data-item">
                    <div class="data-label">ç¸½è‚¡æ•¸</div>
                    <div class="data-value" id="totalShares">2,000</div>
                </div>
                <div class="data-item">
                    <div class="data-label">ç¸½æˆæœ¬</div>
                    <div class="data-value" id="totalCost">42,270</div>
                </div>
                <div class="data-item">
                    <div class="data-label">ç›®å‰å¸‚å€¼</div>
                    <div class="data-value" id="marketValue">42,500</div>
                </div>
                <div class="data-item">
                    <div class="data-label">æœªå¯¦ç¾æç›Š</div>
                    <div class="data-value" id="unrealizedPL" style="color:#27ae60">+230</div>
                </div>
            </div>
        </div>

        <!-- æ‰‹çºŒè²» -->
        <div class="card">
            <div class="data-grid three-col">
                <div class="data-item">
                    <div class="data-label">è²·é€²æ‰‹çºŒè²»</div>
                    <div class="data-value small" style="color:#e67e22">40</div>
                </div>
                <div class="data-item">
                    <div class="data-label">è³£å‡ºæ‰‹çºŒè²»</div>
                    <div class="data-value small" style="color:#e67e22">0</div>
                </div>
                <div class="data-item">
                    <div class="data-label">è­‰äº¤ç¨…</div>
                    <div class="data-value small" style="color:#e67e22">0</div>
                </div>
            </div>
            <div style="text-align:center; margin-top:15px; padding-top:15px; border-top:1px solid #eee;">
                <span style="font-size:14px; color:#7f8c8d;">äº¤æ˜“æˆæœ¬åˆè¨ˆ</span>
                <span style="font-size:22px; font-weight:bold; color:#e67e22; margin-left:10px;">40 å…ƒ</span>
            </div>
        </div>

        <!-- è²·é€²ç´€éŒ„ -->
        <div class="card">
            <div class="section-title">ğŸ“ è²·é€²ç´€éŒ„</div>
            <table class="record-table">
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>è‚¡æ•¸</th>
                        <th>åƒ¹æ ¼</th>
                        <th>æˆæœ¬</th>
                        <th>è‚¡åˆ©</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="date">12/11</td>
                        <td>1,000</td>
                        <td>21.13</td>
                        <td>21,150</td>
                        <td class="dividend">0</td>
                    </tr>
                    <tr>
                        <td class="date">12/16</td>
                        <td>1,000</td>
                        <td>21.10</td>
                        <td>21,120</td>
                        <td class="dividend">0</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="footer" id="footer">æ›´æ–°æ™‚é–“ï¼š2025/12/17</div>

    <script>
        // ===== å­˜è‚¡è³‡æ–™è¨­å®š =====
        const stockData = {
            stockCode: '00878',
            totalShares: 2000,       // ç¸½è‚¡æ•¸
            totalCost: 42270,        // ç¸½æˆæœ¬
            totalDividend: 0,        // å·²é ˜è‚¡åˆ©
            totalFee: 40             // ç¸½æ‰‹çºŒè²»
        };

        // è¨ˆç®—å¹³å‡æˆæœ¬
        stockData.avgCost = (stockData.totalCost / stockData.totalShares).toFixed(2);

        // æ›´æ–°ç•«é¢
        function updateDisplay(price) {
            const currentPrice = parseFloat(price);
            const marketValue = Math.round(currentPrice * stockData.totalShares);
            const unrealizedPL = marketValue - stockData.totalCost;
            const totalPL = unrealizedPL + stockData.totalDividend;
            const profitPercent = ((totalPL / stockData.totalCost) * 100).toFixed(2);

            // æ›´æ–°æ•¸å€¼
            document.getElementById('currentPrice').textContent = currentPrice.toFixed(2);
            document.getElementById('marketValue').textContent = marketValue.toLocaleString();

            // æœªå¯¦ç¾æç›Š
            const plElement = document.getElementById('unrealizedPL');
            plElement.textContent = (unrealizedPL >= 0 ? '+' : '') + unrealizedPL.toLocaleString();
            plElement.style.color = unrealizedPL >= 0 ? '#27ae60' : '#e74c3c';

            // å ±é…¬ç‡å¡ç‰‡
            const profitCard = document.getElementById('profitCard');
            const profitPercentEl = document.getElementById('profitPercent');
            const profitAmountEl = document.getElementById('profitAmount');

            profitPercentEl.textContent = (totalPL >= 0 ? '+' : '') + profitPercent + '%';
            profitAmountEl.textContent = (totalPL >= 0 ? '+' : '') + totalPL.toLocaleString() + ' å…ƒ';

            if (totalPL >= 0) {
                profitCard.classList.remove('negative');
            } else {
                profitCard.classList.add('negative');
            }

            // æ›´æ–°æ™‚é–“
            const now = new Date();
            const timeStr = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
            document.getElementById('footer').textContent = 'æ›´æ–°æ™‚é–“ï¼š' + timeStr;

            // å„²å­˜åˆ°æœ¬åœ°
            localStorage.setItem('00878_lastPrice', currentPrice);
            localStorage.setItem('00878_lastUpdate', timeStr);
        }

        // è‡ªå‹•æŠ“å–è‚¡åƒ¹
        async function fetchPrice() {
            const btn = document.querySelector('.refresh-btn');
            const status = document.getElementById('status');

            btn.disabled = true;
            status.textContent = 'æ­£åœ¨æŠ“å–è‚¡åƒ¹...';

            try {
                // ä½¿ç”¨ CORS proxy æŠ“å– Yahoo Finance è³‡æ–™
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const targetUrl = encodeURIComponent('https://tw.stock.yahoo.com/quote/00878.TW');

                const response = await fetch(proxyUrl + targetUrl);
                const html = await response.text();

                // å¾ HTML ä¸­è§£æè‚¡åƒ¹
                const priceMatch = html.match(/"regularMarketPrice":(\d+\.?\d*)/);

                if (priceMatch && priceMatch[1]) {
                    const price = parseFloat(priceMatch[1]);
                    updateDisplay(price);
                    status.textContent = 'âœ… è‚¡åƒ¹å·²æ›´æ–°';
                } else {
                    throw new Error('ç„¡æ³•è§£æè‚¡åƒ¹');
                }
            } catch (error) {
                console.error('æŠ“å–å¤±æ•—:', error);
                status.textContent = 'âŒ è‡ªå‹•æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥è‚¡åƒ¹';

                // å˜—è©¦å¾æœ¬åœ°è®€å–ä¸Šæ¬¡çš„åƒ¹æ ¼
                const lastPrice = localStorage.getItem('00878_lastPrice');
                if (lastPrice) {
                    status.textContent = 'âŒ æŠ“å–å¤±æ•—ï¼Œé¡¯ç¤ºä¸Šæ¬¡åƒ¹æ ¼ ' + lastPrice;
                }
            }

            btn.disabled = false;
        }


        // é é¢è¼‰å…¥æ™‚ï¼Œå˜—è©¦è®€å–ä¸Šæ¬¡çš„åƒ¹æ ¼
        window.onload = function() {
            const lastPrice = localStorage.getItem('00878_lastPrice');
            if (lastPrice) {
                updateDisplay(parseFloat(lastPrice));
                const lastUpdate = localStorage.getItem('00878_lastUpdate');
                if (lastUpdate) {
                    document.getElementById('footer').textContent = 'æ›´æ–°æ™‚é–“ï¼š' + lastUpdate;
                }
            }
        };
    </script>
</body>
</html>
